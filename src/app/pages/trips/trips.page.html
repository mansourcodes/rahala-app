<ion-header color="secondary">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/search"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- <ion-buttons slot="start">
      <ion-button color="light" (click)="openFiltersManu()">
        <ion-icon slot="start" name="ios-funnel"></ion-icon>
        Filter
      </ion-button>
    </ion-buttons> -->
</ion-header>
<ion-content id="content" class="ion-no-padding background">
  <div class="city-header">
    <div class="city-header-content">
      <div class="city-title">
        <h3>
          سافر إلى
        </h3>
        <h1>
          {{searchTerms.city}}
        </h1>
      </div>
      <div class="search-card">
        <ion-card>
          <ion-item lines="full">
            <ion-icon
              slot="start"
              color="primary"
              [src]="'assets/icon/' + searchTerms.travelBy + '-departure.svg'"
            ></ion-icon>
            <ion-label>{{searchTerms.dateFromString}}</ion-label>
          </ion-item>

          <ion-item lines="full">
            <ion-icon
              slot="start"
              color="primary"
              [src]="'assets/icon/' + searchTerms.travelBy + '-arrival.svg'"
            ></ion-icon>
            <ion-label>{{searchTerms.dateToString}}</ion-label>
          </ion-item>

          <ion-item lines="full">
            <ion-icon
              slot="start"
              color="primary"
              [src]="getTravelByIcon(searchTerms.travelBy)"
            ></ion-icon>
            <ion-label>{{searchTerms.travelBy}}</ion-label>
          </ion-item>

          <div [@slideInOut]="AdvanceInfoAnimationState">
            <ion-item lines="full">
              <ion-icon
                slot="start"
                color="primary"
                src="assets/icon/cafe-outline.svg"
              ></ion-icon>
              <ion-label>الوجبات</ion-label>
              <ion-select
                multiple="true"
                cancelText="Nah"
                okText="Okay!"
                placeholder="-"
                [(ngModel)]="filtersForm.foodOptions"
                (ngModelChange)="onFilterUpdate()"
              >
                <ion-select-option
                  *ngFor="let item of foodOptionsList"
                  selected="{{item.selected}}"
                  >{{item.label}}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item lines="full">
              <ion-label>عدد الأيام</ion-label>
              <ion-range
                min="3"
                max="16"
                step="1"
                [(ngModel)]="filtersForm.numOfDays"
                (ngModelChange)="onFilterUpdate()"
                snaps
                dual-knobs
                pin
                color="secondary"
              >
                <ion-label slot="start">3</ion-label>
                <ion-label slot="end">16</ion-label>
              </ion-range>
            </ion-item>
          </div>
          <ion-item
            lines="full"
            class="text-center"
            (click)="toggleSearchAdvanceInfo()"
          >
            <ion-label *ngIf="AdvanceInfoAnimationState === 'in'">
              <ion-icon src="assets/icon/chevron-up-outline.svg"></ion-icon>
            </ion-label>
            <ion-label *ngIf="AdvanceInfoAnimationState === 'out'">
              <ion-icon src="assets/icon/chevron-down-outline.svg"></ion-icon>
            </ion-label>
          </ion-item>
        </ion-card>
      </div>
    </div>
  </div>

  <!-- <ion-chip color="secondary">
    <ion-label color="dark">only break fast</ion-label>
  </ion-chip> -->

  <ion-grid class="ion-padding">
    <ion-row>
      <ion-col size="12" size-sm="8" offset-sm="2" class="ion-no-padding">
        <div *ngIf="isLoading" class="ion-text-center">
          <ion-spinner color="primary"></ion-spinner>
        </div>
        <div
          class="ion-text-center"
          *ngIf="!isLoading && relevantTrips.length == 0"
        >
          <p>No Trips found!</p>
        </div>

        <div *ngIf="!isLoading && relevantTrips.length > 0">
          <ion-virtual-scroll [items]="relevantTrips " approxItemHeight="100px">
            <ion-card
              button="true"
              *virtualItem="let trip "
              [routerLink]="'/trips/' + trip.id"
              class="card ion-no-margin ion-margin-bottom"
            >
              <ion-row class="vertical-align-content ion-padding-top">
                <ion-col class="ion-no-padding">
                  <div class="ion-text-center w-100">
                    <client-avatar
                      [client]="trip.client"
                      [type]="'avatar'"
                    ></client-avatar>
                  </div>
                </ion-col>
                <ion-col size="2" class="ion-no-padding">
                  <div class="ion-text-center w-100">
                    <ion-icon
                      size="large"
                      color="primary"
                      [src]="trip.travelByIcon"
                    ></ion-icon>
                  </div>
                </ion-col>
                <ion-col class="ion-no-padding">
                  <div class="city-name ion-text-center w-100">
                    <span *ngFor="let city of trip.cities">
                      {{city}}
                    </span>
                  </div>
                </ion-col>
              </ion-row>
              <ion-card-content>
                <div class="trip-name">
                  <span>{{trip.name}}</span>
                </div>
              </ion-card-content>

              <ion-footer>
                <ion-toolbar>
                  <ion-buttons slot="start">
                    <ion-button disabled="false" class="small-padding">
                      {{trip.travelDate}}
                      <ion-icon
                        size="small"
                        slot="start"
                        color="primary"
                        name="md-calendar"
                      ></ion-icon>
                    </ion-button>
                    <ion-button class="small-padding">
                      {{trip.numOfDays}} أيام
                      <ion-icon
                        size="small"
                        slot="start"
                        color="primary"
                        src="assets/icon/day.svg"
                      ></ion-icon>
                    </ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-footer>
              <ion-footer>
                <ion-toolbar>
                  <ion-buttons slot="start">
                    <ion-button class="small-padding">
                      <ion-icon
                        size="small"
                        slot="icon-only"
                        color="primary"
                        [src]="trip.foodOptionIcon"
                      ></ion-icon>
                    </ion-button>
                  </ion-buttons>
                  <ion-buttons slot="end">
                    <ion-button>
                      000 دب
                      <ion-icon slot="end" name="ios-arrow-down"></ion-icon>
                    </ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-footer>
            </ion-card>
          </ion-virtual-scroll>
        </div>

        <ion-infinite-scroll
          threshold="15%"
          (ionInfinite)="loadMoreTrips($event)"
        >
          <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="Loading more data..."
          >
          </ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
